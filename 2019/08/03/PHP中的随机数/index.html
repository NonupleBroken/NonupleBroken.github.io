<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>PHP中的随机数 | NonupleBroken</title><meta name="description" content="php中常用的随机数产生函数是 rand() 和 mt_rand()。但是生成的是伪随机数，不能应用于生成安全令牌、核心加解密 key 等。否则会产生一些安全问题。  何时自动播种 都知道，同一个种子产生的随机序列完全相同，因此种子在随机数中起着至关重要的地位。  自 PHP 4.2.0 起，不再需要用 srand() 或 mt_srand() 给随机数发生器播种 ，因为现在是由系统自动完成的。"><meta name="keywords" content="WEB,PHP,rand,mt_rand"><meta name="author" content="NonupleBroken"><meta name="copyright" content="NonupleBroken"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://i.loli.net/2020/06/15/yNt2zEPRqjwh7IO.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="PHP中的随机数"><meta name="twitter:description" content="php中常用的随机数产生函数是 rand() 和 mt_rand()。但是生成的是伪随机数，不能应用于生成安全令牌、核心加解密 key 等。否则会产生一些安全问题。  何时自动播种 都知道，同一个种子产生的随机序列完全相同，因此种子在随机数中起着至关重要的地位。  自 PHP 4.2.0 起，不再需要用 srand() 或 mt_srand() 给随机数发生器播种 ，因为现在是由系统自动完成的。"><meta name="twitter:image" content="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=PHP中的随机数"><meta property="og:type" content="article"><meta property="og:title" content="PHP中的随机数"><meta property="og:url" content="https://nonuplebroken.com/2019/08/03/PHP%E4%B8%AD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/"><meta property="og:site_name" content="NonupleBroken"><meta property="og:description" content="php中常用的随机数产生函数是 rand() 和 mt_rand()。但是生成的是伪随机数，不能应用于生成安全令牌、核心加解密 key 等。否则会产生一些安全问题。  何时自动播种 都知道，同一个种子产生的随机序列完全相同，因此种子在随机数中起着至关重要的地位。  自 PHP 4.2.0 起，不再需要用 srand() 或 mt_srand() 给随机数发生器播种 ，因为现在是由系统自动完成的。"><meta property="og:image" content="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=PHP中的随机数"><meta property="article:published_time" content="2019-08-03T13:49:53.000Z"><meta property="article:modified_time" content="2020-06-16T07:27:32.417Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://nonuplebroken.com/2019/08/03/PHP%E4%B8%AD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/"><link rel="prev" title="RSA Coppersmith相关攻击" href="https://nonuplebroken.com/2019/11/21/RSA%20Coppersmith%E7%9B%B8%E5%85%B3%E6%94%BB%E5%87%BB/"><link rel="next" title="CBC字节翻转攻击" href="https://nonuplebroken.com/2019/08/02/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-center"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://i.loli.net/2020/06/15/imOPRpIQl1aNYSH.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> About</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#何时自动播种"><span class="toc-number">1.</span> <span class="toc-text"> 何时自动播种</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mt_rand"><span class="toc-number">2.</span> <span class="toc-text"> mt_rand()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rand"><span class="toc-number">3.</span> <span class="toc-text"> rand()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#爆破种子"><span class="toc-number">3.1.</span> <span class="toc-text"> 爆破种子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一个规律"><span class="toc-number">3.2.</span> <span class="toc-text"> 一个规律</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例子"><span class="toc-number">4.</span> <span class="toc-text"> 例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">5.</span> <span class="toc-text"> 参考</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">NonupleBroken</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">PHP中的随机数</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2019-08-03 21:49:53"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2019-08-03</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-06-16 15:27:32"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-06-16</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/WEB/">WEB</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>php中常用的随机数产生函数是 rand() 和 mt_rand()。但是生成的是伪随机数，不能应用于生成安全令牌、核心加解密 key 等。否则会产生一些安全问题。</p>
<h2 id="何时自动播种"><a class="markdownIt-Anchor" href="#何时自动播种"></a> 何时自动播种</h2>
<p>都知道，同一个种子产生的随机序列完全相同，因此种子在随机数中起着至关重要的地位。</p>
<blockquote>
<p>自 PHP 4.2.0 起，不再需要用 srand() 或 mt_srand() 给随机数发生器播种 ，因为现在是由系统自动完成的。</p>
</blockquote>
<p>那么问题是，php 中何时会自动播种呢？如果每次调用随机数都会自动播种那么破解出种子也没有意义。</p>
<p>查看源码发现，每次调用 mt_rand() 都会先检查是否已经播种。如果已经播种就直接产生随机数，否则系统进行自动播种。也就是说每个php进程期间，只有第一次调用 mt_rand() 会自动播种。接下来都会根据这个第一次播种的种子来生成随机数。</p>
<p>那么接下来进行测试。</p>
<p>首先是在本地命令行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php -r <span class="string">"echo mt_rand().' '.mt_rand().' '.mt_rand().' '.mt_rand();"</span></span><br></pre></td></tr></table></figure>
<p>生成了4个随机数：272444184 1241931419 1575764393 1197993479。<br />
那么接下来用 <a href="https://www.openwall.com/php_mt_seed" target="_blank" rel="noopener">php_mt_seed</a> 工具来爆破种子，此工具可以根据第一个生成的随机数来猜测可能的种子，其实就是枚举测试了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./php_mt_seed 272444184</span><br></pre></td></tr></table></figure>
<p>一共找到了 10 个种子，选择自己的 php 版本，挨个手动播种进行测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php -r <span class="string">"mt_srand(2294193663); echo mt_rand().' '.mt_rand().' '.mt_rand().' '.mt_rand();"</span></span><br></pre></td></tr></table></figure>
<p>发现 2294193663 这个种子结果完全一致。</p>
<p>这种方式每个进程期间共用一个种子，每个 php 命令行都是一个进程。如果再重复生成随机数的过程，由于不是同一个进程种子当然不一样。</p>
<p>那么 web 服务器中的 php 呢？由于 php 的运行模式、web 服务器种类（apache、nginx）等不同，有可能每个进程只处理一个请求，也有可能一个进程处理多个请求之后才会被回收，当然超时也会被回收。这块查了一些资料，网上说的也不是很清楚，具体的还不是很明白。</p>
<p>做个测试：</p>
<p>开个简单的web服务，php-fpm 5.6，nginx：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> mt_rand().<span class="string">' '</span>.mt_rand(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>编写脚本，分别用两台不同出口 IP 的客户端访问：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    res += requests.get(url=<span class="string">'http://xxx'</span>).text.split()</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>相差 5s 运行脚本，这样就可以间隔拿到随机数了。两个客户端的随机数如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&#39;1063882594&#39;, &#39;83620778&#39;, &#39;792103107&#39;, &#39;325549112&#39;, &#39;409866403&#39;, &#39;177599907&#39;]</span><br><span class="line">[&#39;311111307&#39;, &#39;285085670&#39;, &#39;1274478122&#39;, &#39;721750928&#39;, &#39;260625958&#39;, &#39;1103889931&#39;]</span><br></pre></td></tr></table></figure>
<p>爆破下种子，这与 3521803456 这个种子的结果一致。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1063882594 83620778 311111307 285085670 792103107 325549112 1274478122 721750928 409866403 177599907 260625958 1103889931 1560118614 1060634432 1320660042</span><br></pre></td></tr></table></figure>
<p>因此可以发现对一段时间内的请求，服务器是用同一个进程处理的。这无疑加大了 rand() 和 mt_rand() 的利用难度，使之较为安全。因为你根本不知道服务器何时会回收进程，也就不知道何时会播种，也不知道你这次请求的第一个随机数其实是播种后产生的第几个随机数，无法爆破种子。除非，网站几乎没人访问，或者夜黑风高之时。</p>
<p>当然某次访问如果产生第一个随机数时恰好播种，会产生极大的危险。</p>
<h2 id="mt_rand"><a class="markdownIt-Anchor" href="#mt_rand"></a> mt_rand()</h2>
<p>php 的 mt_rand() 函数是基于 MT19937 随机数生成算法而来。<br />
函数原型是：<code>mt_rand ( int $min , int $max ) : int</code><br />
如果没有提供可选参数 min 和 max，mt_rand() 返回 0 到 mt_getrandmax() 之间的伪随机数。<br />
如果设定范围，php5 和 php7 的算法稍有不同：<br />
php5：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">RAND_RANGE</span><span class="params">(__n, __min, __max, __tmax)</span> </span>&#123;</span><br><span class="line">    (__n) = (__min) + (<span class="keyword">long</span>) ((<span class="keyword">double</span>) ((<span class="keyword">double</span>) (__max) - (__min) + <span class="number">1.0</span>) * ((__n) / ((__tmax) + <span class="number">1.0</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">number = (<span class="keyword">long</span>) (php_mt_rand(TSRMLS_C) &gt;&gt; <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (argc == <span class="number">2</span>)</span><br><span class="line">    RAND_RANGE(number, <span class="built_in">min</span>, <span class="built_in">max</span>, PHP_MT_RAND_MAX);</span><br><span class="line">RETURN_LONG(number);</span><br></pre></td></tr></table></figure>
<p>而 php7 为：<code>(php_mt_rand() % (max-min+1)) + min</code></p>
<p>现在 php_mt_seed 最新版 4.0 对两种算法都已支持。直接爆破种子即可。</p>
<p>顺便一提，php_mt_seed 工具中存在范围和未知随机数的使用方式。<br />
假设有这样 10 个带范围的随机数，前 2 个随机数未知：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">mt_srand(<span class="number">0x8fffffff</span>);</span><br><span class="line">mt_rand(<span class="number">200</span>, <span class="number">2000</span>).<span class="string">', '</span>;</span><br><span class="line">mt_rand(<span class="number">100</span>, <span class="number">1000</span>).<span class="string">', '</span>;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;<span class="number">4</span>; $i++) &#123;</span><br><span class="line">    <span class="keyword">echo</span> mt_rand(<span class="number">200</span>, <span class="number">2000</span>).<span class="string">', '</span>;</span><br><span class="line">    <span class="keyword">echo</span> mt_rand(<span class="number">100</span>, <span class="number">1000</span>).<span class="string">', '</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到：<br />
<code>1005, 230, 1780, 514, 885, 486, 926, 713</code><br />
那么可以这样写命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./php_mt_seed 200 2000 200 2000 100 1000 100 1000 1005 1005 200 2000 230 230 100 1000 1780 1780 200 2000 514 514 100 1000 885 885 200 2000 486 486 100 1000 926 926 200 2000 713 713 100 1000</span><br></pre></td></tr></table></figure>
<p>每个随机数都包括四个参数，实际最小值，实际最大值，范围最小值，范围最大值。如果随机数已知，那么实际最小值和实际最大值相同，就是实际值。如果未知，那么实际最小值和实际最大值可以是范围最小值和范围最大值，也可以是 <code>0,0</code>。但貌似不能混用。</p>
<h2 id="rand"><a class="markdownIt-Anchor" href="#rand"></a> rand()</h2>
<p>php7 中的 rand() 同 mt_rand()，srand() 同 mt_srand()。</p>
<p>php5 中的 rand 函数调用的是 glibc 中的 random()。其实现算法可以简化为如下代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 1000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> seed 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PHP_RAND_MAX 2147483647</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r[<span class="number">344</span>+MAX];</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    r[<span class="number">0</span>] = seed;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;<span class="number">31</span>; i++) &#123;</span><br><span class="line">        r[i] = (<span class="number">16807L</span>L * r[i<span class="number">-1</span>]) % PHP_RAND_MAX;</span><br><span class="line">        <span class="keyword">if</span> (r[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            r[i] += PHP_RAND_MAX;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">31</span>; i&lt;<span class="number">34</span>; i++) &#123;</span><br><span class="line">        r[i] = r[i<span class="number">-31</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">34</span>; i&lt;<span class="number">344</span>; i++) &#123;</span><br><span class="line">        r[i] = r[i<span class="number">-31</span>] + r[i<span class="number">-3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">344</span>; i&lt;(MAX+<span class="number">344</span>); i++) &#123;</span><br><span class="line">        r[i] = r[i<span class="number">-31</span>] + r[i<span class="number">-3</span>];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)r[i]) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>r[344] 就是生成的第一个随机数。<br />
设定范围的算法与 php5 中 mt_rand() 的设定范围的算法相同。</p>
<h3 id="爆破种子"><a class="markdownIt-Anchor" href="#爆破种子"></a> 爆破种子</h3>
<p>rand() 函数要爆破种子没有现成的工具用，因此我自己根据 rand() 的算法写了一个多进程的脚本用，C 很久没写了，勉强能用。8 核 CPU 爆破完需要大约 15 分钟。<br />
MAX_POOL 是进程数，PHP_RAND_MAX 是 getrandmax() 获得的随机数的最大值，Linux 下是 2147483647，Windows 下是 32767。res 是取了范围后的随机数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_POOL 8</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIN 10</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 2000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PHP_RAND_MAX 2147483647</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> res[] = &#123;<span class="number">1803</span>, <span class="number">1415</span>, <span class="number">1733</span>, <span class="number">1069</span>, <span class="number">760</span>, <span class="number">344</span>, <span class="number">1232</span>, <span class="number">137</span>&#125;;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> count = (<span class="keyword">int</span>)(<span class="keyword">sizeof</span>(res) / <span class="keyword">sizeof</span>(res[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_eq</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> x)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_data</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seed)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">RAND_RANGE</span><span class="params">(<span class="keyword">int</span> __n, <span class="keyword">int</span> __min, <span class="keyword">int</span> __max, <span class="keyword">int</span> __tmax)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_eq</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == res[i])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_data</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> r[count+<span class="number">344</span>];</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    r[<span class="number">0</span>] = seed;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;<span class="number">31</span>; i++) &#123;</span><br><span class="line">        r[i] = (<span class="number">16807L</span>L * r[i<span class="number">-1</span>]) % PHP_RAND_MAX;</span><br><span class="line">        <span class="keyword">if</span> (r[i] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            r[i] += PHP_RAND_MAX;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">31</span>; i&lt;<span class="number">34</span>; i++) &#123;</span><br><span class="line">        r[i] = r[i<span class="number">-31</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">34</span>; i&lt;<span class="number">344</span>; i++) &#123;</span><br><span class="line">        r[i] = r[i<span class="number">-31</span>] + r[i<span class="number">-3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">344</span>; i&lt;(count+<span class="number">344</span>); i++) &#123;</span><br><span class="line">        r[i] = r[i<span class="number">-31</span>] + r[i<span class="number">-3</span>];</span><br><span class="line">        <span class="keyword">int</span> ans = ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)r[i] &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        ans = RAND_RANGE(ans, MIN, MAX, PHP_RAND_MAX);</span><br><span class="line">        <span class="keyword">if</span> (!is_eq(i<span class="number">-344</span>, ans))</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"======== find seed %u ========\n"</span>, seed);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">RAND_RANGE</span><span class="params">(<span class="keyword">int</span> __n, <span class="keyword">int</span> __min, <span class="keyword">int</span> __max, <span class="keyword">int</span> __tmax)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x = (__min) + (<span class="keyword">long</span>) ((<span class="keyword">double</span>) ( (<span class="keyword">double</span>) (__max) - (__min) + <span class="number">1.0</span>) * ((__n) / ((__tmax) + <span class="number">1.0</span>)));</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> <span class="keyword">const</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;MAX_POOL; i++) &#123;</span><br><span class="line">        pid = fork();</span><br><span class="line">        <span class="keyword">if</span> (pid != <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Process %d fork error\n"</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"ParProcess working. Pid=%d.\n"</span>, getpid());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"SubProcess %d working. Pid=%d.\n"</span>, i, getpid());</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> every = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">0xffffffff</span> / MAX_POOL);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> start=i*every; start&lt;<span class="number">0xffffffff</span> &amp;&amp; start&lt;(i+<span class="number">1</span>)*every; start++) &#123;</span><br><span class="line">            get_data(start);</span><br><span class="line">            <span class="keyword">if</span> ((start % <span class="number">20000000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">double</span> t = start - i*every;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Process: %d %.2f\%\r"</span>, i, t/every*<span class="number">100</span>);</span><br><span class="line">                fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找到了一个种子：3381418098</p>
<p><img src="https://i.loli.net/2020/06/11/dnyzkGQsNCPSxVY.png" alt="php_rand_1" /></p>
<h3 id="一个规律"><a class="markdownIt-Anchor" href="#一个规律"></a> 一个规律</h3>
<p>从 rand 函数的生成算法入手，其实是有规律的。由于 <code>r[i] = r[i-31] + r[i-3]</code>，如果同一种子连续生成了 31 个随机数，那么之后的随机数是可以预测的，尽管由于位移和设定范围时的算法影响。至于到底 r[i] 和 r[i-31] + r[i-3] 有什么规律，这一点网上的文章目前没有一篇说的清楚，因此自己尝试：</p>
<p>首先用同一种子随机生成 10 到 10000 的 100 万个随机数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;<span class="number">1000000</span>; $i++) &#123; <span class="keyword">echo</span> rand(<span class="number">10</span>, <span class="number">10000</span>).<span class="string">' '</span>;&#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php -f t.php &gt; res.txt</span><br></pre></td></tr></table></figure>
<p>用 python 编写脚本读取数据，统计 <code>r[i]+r[i+28]</code> 与 <code>r[i+31]</code> 的差值，看有什么规律：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NUM = <span class="number">1000000</span></span><br><span class="line">data = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> open(<span class="string">'res.txt'</span>).read().split()]</span><br><span class="line">save = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(NUM<span class="number">-31</span>):</span><br><span class="line">    t  = data[i] + data[i+<span class="number">28</span>] - data[i+<span class="number">31</span>]</span><br><span class="line">    save[t] = save[t]+<span class="number">1</span> <span class="keyword">if</span> t <span class="keyword">in</span> save <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">print(save)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;10001: 249677, 10: 250196, 10000: 249970, 9: 250126&#125;</span></span><br></pre></td></tr></table></figure>
<p>惊讶的发现，<code>r[i] + r[i+28] - r[i+31]</code> 的值肯定是 min、max、min-1、max+1 中的一个，并且概率相等。<br />
更进一步，其实预测一个随机数时，只可能有两种情况，差值要么是 min 或 min-1，要么就是 max、max+1，这是由于移位时的误差，不会同时存在四种情况。<br />
现在模拟预测一下，编写脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MIN = <span class="number">10</span></span><br><span class="line">MAX = <span class="number">10000</span></span><br><span class="line">NUM = <span class="number">1000000</span></span><br><span class="line">possible = (MIN, MAX, MIN<span class="number">-1</span>, MAX+<span class="number">1</span>)</span><br><span class="line">data = [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> open(<span class="string">'res.txt'</span>).read().split()]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">31</span>, NUM):</span><br><span class="line">    ans = []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> possible:</span><br><span class="line">        tmp = data[i<span class="number">-3</span>] + data[i<span class="number">-31</span>] - x</span><br><span class="line">        <span class="keyword">if</span> MIN &lt;= tmp &lt;= MAX:</span><br><span class="line">            ans.append(tmp)</span><br><span class="line">    <span class="keyword">if</span> (data[i] <span class="keyword">not</span> <span class="keyword">in</span> ans) <span class="keyword">or</span> (len(ans) != <span class="number">2</span>):</span><br><span class="line">        print(data[i], ans)</span><br></pre></td></tr></table></figure>
<p>没有输出任何结果，预测正确。</p>
<p>因此，如果要向后预测 n 位，现在将可能结果减小到了 2^n 个。用 python 写了个预测脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data=<span class="number">0</span>, parent=None, lchild=None, rchild=None)</span>:</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.parent = parent</span><br><span class="line">        self.lchild = lchild</span><br><span class="line">        self.rchild = rchild</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BTree</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, data=None)</span>:</span></span><br><span class="line">        self.head = Node(data)</span><br><span class="line">        self.leaves = self.head</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    strs = <span class="string">"QWERTYUIOPASDFGHJKLZXCVBNM1234567890qwertyuiopasdfghjklzxcvbnm"</span></span><br><span class="line">    rand_str = <span class="string">"N34sgD93L32HrROKJ9B6Rpzt6YvbHqE"</span></span><br><span class="line">    MIN = <span class="number">0</span></span><br><span class="line">    MAX = <span class="number">61</span></span><br><span class="line">    N = <span class="number">10</span></span><br><span class="line">    possible = (MIN, MAX, MIN<span class="number">-1</span>, MAX+<span class="number">1</span>)</span><br><span class="line">    num = [strs.find(x) <span class="keyword">for</span> x <span class="keyword">in</span> rand_str]</span><br><span class="line">    <span class="keyword">assert</span> len(rand_str) &gt;= <span class="number">31</span></span><br><span class="line">    print(num)</span><br><span class="line">    </span><br><span class="line">    tree = BTree(num[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(num)):</span><br><span class="line">        tmp = tree.leaves</span><br><span class="line">        tree.leaves = Node(num[i], tmp)</span><br><span class="line">        tmp.lchild = tree.leaves</span><br><span class="line"></span><br><span class="line">    tree.leaves = [tree.leaves]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">        leaf = []</span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> tree.leaves:</span><br><span class="line">            tmp = node</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">30</span>):</span><br><span class="line">                tmp = tmp.parent</span><br><span class="line">                <span class="keyword">if</span> j == <span class="number">1</span>:</span><br><span class="line">                    a = tmp.data</span><br><span class="line">                <span class="keyword">if</span> j == <span class="number">29</span>:</span><br><span class="line">                    b = tmp.data</span><br><span class="line">            <span class="keyword">for</span> posb <span class="keyword">in</span> possible:</span><br><span class="line">                tmp = a + b - posb</span><br><span class="line">                <span class="keyword">if</span> MIN &lt;= tmp &lt;= MAX:</span><br><span class="line">                    <span class="keyword">if</span> node.lchild == <span class="literal">None</span>:</span><br><span class="line">                        node.lchild = Node(tmp, node)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        node.rchild = Node(tmp, node)</span><br><span class="line">            leaf.append(node.lchild)</span><br><span class="line">            leaf.append(node.rchild)</span><br><span class="line">        tree.leaves = leaf</span><br><span class="line"></span><br><span class="line">    save = []</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> tree.leaves:</span><br><span class="line">        tmp1 = []</span><br><span class="line">        tmp2 = node</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">            tmp1.append(tmp2.data)</span><br><span class="line">            tmp2 = tmp2.parent</span><br><span class="line">        ans = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> tmp1[::<span class="number">-1</span>]:</span><br><span class="line">            ans += strs[i]</span><br><span class="line">        save.append(ans)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> save:</span><br><span class="line">        print(x)</span><br></pre></td></tr></table></figure>
<h2 id="例子"><a class="markdownIt-Anchor" href="#例子"></a> 例子</h2>
<ul>
<li>PHPCMS MT_RAND SEED CRACK 致 authkey 泄露<br />
<a href="https://xz.aliyun.com/t/30" target="_blank" rel="noopener">https://xz.aliyun.com/t/30</a></li>
<li>Discuz_X authkey 泄露<br />
<a href="https://lorexxar.cn/2017/08/31/dz-authkey/" target="_blank" rel="noopener">https://lorexxar.cn/2017/08/31/dz-authkey/</a></li>
<li>一道 CTF 题目：<br />
<a href="https://github.com/wonderkun/CTF_web/blob/master/web500-2/writeup.pdf" target="_blank" rel="noopener">https://github.com/wonderkun/CTF_web/blob/master/web500-2/writeup.pdf</a></li>
</ul>
<h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2>
<ul>
<li><a href="https://mp.weixin.qq.com/s/3TgBKXHw3MC61qIYELanJg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/3TgBKXHw3MC61qIYELanJg</a></li>
<li><a href="https://5alt.me/2017/06/php%E9%87%8C%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/" target="_blank" rel="noopener">https://5alt.me/2017/06/php里的随机数/</a></li>
<li><a href="http://www.sjoerdlangkemper.nl/2016/02/11/cracking-php-rand/" target="_blank" rel="noopener">http://www.sjoerdlangkemper.nl/2016/02/11/cracking-php-rand/</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">NonupleBroken</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://nonuplebroken.com/2019/08/03/PHP%E4%B8%AD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/">https://nonuplebroken.com/2019/08/03/PHP%E4%B8%AD%E7%9A%84%E9%9A%8F%E6%9C%BA%E6%95%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WEB/">WEB</a><a class="post-meta__tags" href="/tags/PHP/">PHP</a><a class="post-meta__tags" href="/tags/rand/">rand</a><a class="post-meta__tags" href="/tags/mt-rand/">mt_rand</a></div><div class="post_share"><div class="social-share" data-image="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=2021津门杯justOCB" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://i.loli.net/2020/06/15/IhSBM3Q576veJYy.png" alt="WeChat Pay"/><div class="post-qr-code__desc">WeChat Pay</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://i.loli.net/2020/06/15/SI8vipmr2UCxbtR.png" alt="Alipay"/><div class="post-qr-code__desc">Alipay</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/11/21/RSA%20Coppersmith%E7%9B%B8%E5%85%B3%E6%94%BB%E5%87%BB/"><img class="prev_cover" src="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=RSA-Coppersmith相关攻击" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">RSA Coppersmith相关攻击</div></div></a></div><div class="next-post pull_right"><a href="/2019/08/02/CBC%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/"><img class="next_cover" src="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=CBC字节翻转攻击" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">CBC字节翻转攻击</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'W5gBlULjrFdLa2PMBAsaecvL-gzGzoHsz',
  appKey: 'e7tEGcjJPX1J35kwFEqnWK0X',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'identicon',
  meta: guestInfo,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By NonupleBroken</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Welcome and have fun!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>