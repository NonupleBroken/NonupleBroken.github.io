<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>浅谈SOP同源策略 | NonupleBroken</title><meta name="description" content="web 安全的基石就是同源政策。  何为同源 几个页面的协议、主机名、端口相同，那么就认为这些页面是同源的。 如与 http:&#x2F;&#x2F;book.nonuplebroken.com:80&#x2F;index.php 比较：    URL 是否同源 备注     http:&#x2F;&#x2F;book.nonuplebroken.com:80&#x2F;api&#x2F;check.php 是    https:&#x2F;&#x2F;book.nonuplebrok"><meta name="keywords" content="WEB,XSS,SOP,CORS,JSONP"><meta name="author" content="NonupleBroken"><meta name="copyright" content="NonupleBroken"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://i.loli.net/2020/06/15/yNt2zEPRqjwh7IO.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="浅谈SOP同源策略"><meta name="twitter:description" content="web 安全的基石就是同源政策。  何为同源 几个页面的协议、主机名、端口相同，那么就认为这些页面是同源的。 如与 http:&#x2F;&#x2F;book.nonuplebroken.com:80&#x2F;index.php 比较：    URL 是否同源 备注     http:&#x2F;&#x2F;book.nonuplebroken.com:80&#x2F;api&#x2F;check.php 是    https:&#x2F;&#x2F;book.nonuplebrok"><meta name="twitter:image" content="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=浅谈SOP同源策略"><meta property="og:type" content="article"><meta property="og:title" content="浅谈SOP同源策略"><meta property="og:url" content="https://nonuplebroken.com/2019/07/13/%E6%B5%85%E8%B0%88SOP%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"><meta property="og:site_name" content="NonupleBroken"><meta property="og:description" content="web 安全的基石就是同源政策。  何为同源 几个页面的协议、主机名、端口相同，那么就认为这些页面是同源的。 如与 http:&#x2F;&#x2F;book.nonuplebroken.com:80&#x2F;index.php 比较：    URL 是否同源 备注     http:&#x2F;&#x2F;book.nonuplebroken.com:80&#x2F;api&#x2F;check.php 是    https:&#x2F;&#x2F;book.nonuplebrok"><meta property="og:image" content="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=浅谈SOP同源策略"><meta property="article:published_time" content="2019-07-13T14:20:49.000Z"><meta property="article:modified_time" content="2020-06-16T07:15:59.246Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://nonuplebroken.com/2019/07/13/%E6%B5%85%E8%B0%88SOP%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/"><link rel="prev" title="浅谈CSP内容安全策略" href="https://nonuplebroken.com/2019/07/20/%E6%B5%85%E8%B0%88CSP%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/"><link rel="next" title="XSS小结" href="https://nonuplebroken.com/2019/07/06/XSS%E5%B0%8F%E7%BB%93/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-center"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://i.loli.net/2020/06/15/imOPRpIQl1aNYSH.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">7</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> About</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#何为同源"><span class="toc-number">1.</span> <span class="toc-text"> 何为同源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#何为同源策略"><span class="toc-number">2.</span> <span class="toc-text"> 何为同源策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#限制范围"><span class="toc-number">3.</span> <span class="toc-text"> 限制范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨源的网络访问"><span class="toc-number">4.</span> <span class="toc-text"> 跨源的网络访问</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#具备src的标签"><span class="toc-number">4.1.</span> <span class="toc-text"> 具备src的标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jsonp"><span class="toc-number">4.2.</span> <span class="toc-text"> JSONP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#跨域资源共享"><span class="toc-number">4.3.</span> <span class="toc-text"> 跨域资源共享</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#简单请求"><span class="toc-number">4.3.1.</span> <span class="toc-text"> 简单请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#非简单请求"><span class="toc-number">4.3.2.</span> <span class="toc-text"> 非简单请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windowname"><span class="toc-number">4.4.</span> <span class="toc-text"> window.name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#documentdomain"><span class="toc-number">4.5.</span> <span class="toc-text"> document.domain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#locationhash"><span class="toc-number">4.6.</span> <span class="toc-text"> location.hash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windowpostmessage"><span class="toc-number">4.7.</span> <span class="toc-text"> window.postMessage</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考"><span class="toc-number">5.</span> <span class="toc-text"> 参考</span></a></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">NonupleBroken</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">浅谈SOP同源策略</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2019-07-13 22:20:49"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2019-07-13</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-06-16 15:15:59"><i class="fa fa-history" aria-hidden="true"></i> Updated 2020-06-16</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/WEB/">WEB</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><p>web 安全的基石就是同源政策。</p>
<h2 id="何为同源"><a class="markdownIt-Anchor" href="#何为同源"></a> 何为同源</h2>
<p>几个页面的协议、主机名、端口相同，那么就认为这些页面是同源的。<br />
如与 <a href="http://book.nonuplebroken.com:80/index.php" target="_blank" rel="noopener">http://book.nonuplebroken.com:80/index.php</a> 比较：</p>
<table>
<thead>
<tr>
<th style="text-align:left">URL</th>
<th style="text-align:center">是否同源</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="http://book.nonuplebroken.com:80/api/check.php" target="_blank" rel="noopener">http://book.nonuplebroken.com:80/api/check.php</a></td>
<td style="text-align:center">是</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:left"><a href="https://book.nonuplebroken.com:80/index.php" target="_blank" rel="noopener">https://book.nonuplebroken.com:80/index.php</a></td>
<td style="text-align:center">否</td>
<td style="text-align:center">协议不同</td>
</tr>
<tr>
<td style="text-align:left"><a href="http://news.nonuplebroken.com:80/index.php" target="_blank" rel="noopener">http://news.nonuplebroken.com:80/index.php</a></td>
<td style="text-align:center">否</td>
<td style="text-align:center">host不同</td>
</tr>
<tr>
<td style="text-align:left"><a href="http://book.nonuplebroken.com:8000/index.php" target="_blank" rel="noopener">http://book.nonuplebroken.com:8000/index.php</a></td>
<td style="text-align:center">否</td>
<td style="text-align:center">端口不同</td>
</tr>
</tbody>
</table>
<p>对于 <code>about:blank</code> 和 <code>javascript:</code> 这种特殊的 URL，他们的源应当是继承自加载他们的页面的源。</p>
<h2 id="何为同源策略"><a class="markdownIt-Anchor" href="#何为同源策略"></a> 何为同源策略</h2>
<p>同源策略（Same Origin Policy，SOP）是 Web 应用程序的一种安全模型，主要是限制了页面从另一个源加载资源时的行为。而且既然只是一种模型，那么不同组织企业实现时就会有不少差异。</p>
<p>同源策略只作用在实现了同源策略的 WEB 客户端上。 现在网上对同源策略有一个错误的解释：只有和目标同源的脚本才会被执行。这是不对的，同源策略没有禁止脚本的执行，而是禁止读取 HTTP 回复。因此会发现，同源策略的作用其实很有限，如防止 CSRF 攻击。</p>
<h2 id="限制范围"><a class="markdownIt-Anchor" href="#限制范围"></a> 限制范围</h2>
<p>如果非同源，共有三种行为受到限制：</p>
<ol>
<li>Cookie、LocalStorage 和 IndexDB 无法读取。</li>
<li>DOM 无法获得。</li>
<li>AJAX 请求不能发送。</li>
</ol>
<p>同源策略对于防范恶意页面是一种很好的防御机制，如果恶意脚本请求了非同源的一个资源，那么这种行为就很可能因为同源策略的限制被浏览器拒绝回复，从而在某种程度上缓解了攻击。虽然这些限制是必要的，但是有时很不方便，合理的用途也受到影响。因此有一些方法规避上面三种限制。</p>
<h2 id="跨源的网络访问"><a class="markdownIt-Anchor" href="#跨源的网络访问"></a> 跨源的网络访问</h2>
<p>现在知道了浏览器会根据同源策略允许或拒绝加载某些资源。可是想一想实际中的网页，就发现了问题：网站通常会将静态文件（css、js、图片）等放置在 CDN 上，那么 CDN 与当前域必然是不同源的。那么这是怎么回事呢？这就是跨源的网络访问。</p>
<p>页面跨域的行为主要会分为三类，分别是：</p>
<ul>
<li>
<p>Cross-origin write，跨域写。通常被允许，例如链接，重定向和表单提交，一些不常见的HTTP请求方法例如 PUT、DELETE 等需要先发送预请求（preflight），例如发送OPTIONS来查询可用的方法。</p>
</li>
<li>
<p>Cross-origin embedding，跨域嵌入，通常被允许。</p>
</li>
<li>
<p>Cross-origin read，跨域读。通常被禁止，然而，我们可以用其他方法达到读取的效果。</p>
</li>
</ul>
<p>一些可以跨域的方法：</p>
<h3 id="具备src的标签"><a class="markdownIt-Anchor" href="#具备src的标签"></a> 具备src的标签</h3>
<p>所有具有src属性的HTML标签都是可以跨域的，如 <code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code> 和 <code>&lt;link&gt;</code> 这几个标签是可以加载跨域的资源的，并且加载的方式其实相当于一次普通的 GET 请求，唯一不同的是，为了安全起见，浏览器不允许这种方式下对加载到的资源的读写操作，而只能使用标签本身应当具备的能力（比如脚本执行、样式应用等等）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># img标签跨域获取了一个图片资源，并且正常显示：</span><br><span class="line">&lt;img src&#x3D;&quot;http:&#x2F;&#x2F;img0.imgtn.bdimg.com&#x2F;it&#x2F;u&#x3D;1619683067,2993665289&amp;fm&#x3D;26&amp;gp&#x3D;0.jpg&quot;&gt;</span><br><span class="line"></span><br><span class="line"># script标签跨域获取了一个js脚本，也可以正常执行：</span><br><span class="line">&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;119.23.37.178:8000&#x2F;myjs&#x2F;alert.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line"># 虽然可以获取到资源，但无法执行</span><br><span class="line">&lt;img src&#x3D;&quot;http:&#x2F;&#x2F;119.23.37.178:8000&#x2F;myjs&#x2F;alert.js&quot;&gt;</span><br><span class="line"></span><br><span class="line"># link标签同样也可以跨域</span><br><span class="line">&lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;http:&#x2F;&#x2F;119.23.37.178:8000&#x2F;myjs&#x2F;alert.js&quot;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="jsonp"><a class="markdownIt-Anchor" href="#jsonp"></a> JSONP</h3>
<p>JSONP 跨域是一个非官方的协议。由于 <code>&lt;script&gt;</code> 标签是可以跨域的，而且在跨域脚本中可以直接回调当前脚本的函数，通过预先设定好的 callback 函数来实现和母页面的交互，通过 JSON 来传参，即将 JSON 数据填充进回调函数，这就是 JSONP 的 JSON with Padding 的含义。JSONP 只支持 GET 请求。</p>
<p>例如，前端：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">addScriptTag</span><span class="params">(src)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span></span><br><span class="line"><span class="actionscript">    script.setAttribute(<span class="string">"type"</span>, <span class="string">"text/javascript"</span>);</span></span><br><span class="line">    script.src = src;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(script);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">    addScriptTag(<span class="string">'http://66.42.62.66:8080/?callback=work'</span>);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">(data)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'Your random int is: '</span> + data.int);</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码通过动态添加 <code>&lt;script&gt;</code> 标签，向服务器发出请求。服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。</p>
<p>后端：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$callback = $_GET[<span class="string">'callback'</span>];  <span class="comment">// 得到回调函数名</span></span><br><span class="line">$data = <span class="keyword">array</span>(<span class="string">'int'</span> =&gt; mt_rand(<span class="number">0</span>, <span class="number">10000</span>));  <span class="comment">// 要返回的数据</span></span><br><span class="line"><span class="keyword">echo</span> $callback. <span class="string">'('</span>. json_encode($data). <span class="string">')'</span>;  <span class="comment">// 输出</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于 <code>&lt;script&gt;</code> 标签请求的脚本，直接作为代码运行。这时，只要浏览器定义了 work 函数，该函数就会立即调用。作为参数的 JSON 数据被视为 JavaScript 对象。</p>
<h3 id="跨域资源共享"><a class="markdownIt-Anchor" href="#跨域资源共享"></a> 跨域资源共享</h3>
<p>跨域资源共享（Cross Origin Resource Share，CORS），允许浏览器向跨源服务器，发出 XMLHttpRequest 请求，从而克服了 AJAX 只能同源使用的限制。CORS需要服务器端设置 <code>Access-Control-Allow-Origin</code> 头，否则浏览器会因为安全策略拦截返回的信息。</p>
<p>CORS 又分为简单跨域和非简单跨域请求。</p>
<h4 id="简单请求"><a class="markdownIt-Anchor" href="#简单请求"></a> 简单请求</h4>
<p>简单请求满足以下两个条件：</p>
<ul>
<li>
<p>请求方法是以下三种方法之一：</p>
<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
</li>
<li>
<p>HTTP 的头信息不超出以下几种字段：</p>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值：application/x-www-form-urlencoded、multipart/form-data、text/plain</li>
</ul>
</li>
</ul>
<p>其他的都是非简单请求。</p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="actionscript">xhr.open(<span class="string">"GET"</span>, <span class="string">"http://66.42.62.66:8080/ajax.php?a=123456"</span>, <span class="literal">true</span>);</span></span><br><span class="line">xhr.send();</span><br><span class="line"><span class="actionscript">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">    if (xhr.status == 200 &amp;&amp; xhr.readyState == 4) &#123;</span><br><span class="line">          alert(xhr.responseText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当浏览器判定此次请求是简单请求，会在请求头中增加一个 <code>Origin</code> 字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Origin: http:&#x2F;&#x2F;www.test.com</span><br></pre></td></tr></table></figure>
<p>服务器根据 <code>Origin</code> 判断是否允许此次请求，如果允许会返回响应头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;www.test.com</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Expose-Headers: flag</span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ol>
<li>
<p>Access-Control-Allow-Origin<br />
该字段必须。它的值要么是请求时Origin字段的值，要么是一个 <code>*</code>，表示接受任意域名的请求。</p>
</li>
<li>
<p>Access-Control-Allow-Credentials<br />
该字段可选。它的值是一个布尔值，表示是否允许发送 Cookie。默认情况下，Cookie 不包括在 CORS 请求之中。若要发送 Cookie，AJAX 中必须设置 <code>xhr.withCredentials = true;</code>，而且 Access-Control-Allow-Origin 不能为星号。Cookie 依然遵循同源策略。</p>
</li>
<li>
<p>Access-Control-Expose-Headers<br />
该字段可选。CORS 请求时，XMLHttpRequest 对象的 getResponseHeader() 方法只能拿到6个基本字段：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma。如果想拿到其他字段，就必须在 Access-Control-Expose-Headers 里面指定。</p>
</li>
</ol>
<p>如果服务器会不允许，则返回一个正常的 HTTP 回应。浏览器发现就知道错了，抛出一个错误。</p>
<h4 id="非简单请求"><a class="markdownIt-Anchor" href="#非简单请求"></a> 非简单请求</h4>
<p>非简单请求的 CORS，浏览器会在正式通信之前，增加一次 HTTP 查询请求，称为&quot;预检&quot;请求（preflight）。</p>
<p>例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="actionscript">xhr.open(<span class="string">"PUT"</span>, <span class="string">"http://66.42.62.66:8080/ajax.php"</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="actionscript">xhr.setRequestHeader(<span class="string">'X-Admin'</span>, <span class="string">'1'</span>);</span></span><br><span class="line">xhr.send();</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>浏览器发现，这是一个非简单请求，就自动发出一个&quot;预检&quot;请求，请求头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Origin: http:&#x2F;&#x2F;www.test.com</span><br><span class="line">Access-Control-Request-Method: PUT</span><br><span class="line">Access-Control-Request-Headers: X-Admin</span><br></pre></td></tr></table></figure>
<p>服务器收到&quot;预检&quot;请求以后，检查了 Origin、Access-Control-Request-Method 和 Access-Control-Request-Headers 字段以后，允许跨源请求，则响应头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;www.test.com</span><br><span class="line">Access-Control-Allow-Methods: GET, POST, PUT</span><br><span class="line">Access-Control-Allow-Headers: X-Admin, X-Guest </span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line">Access-Control-Max-Age: 172800</span><br></pre></td></tr></table></figure>
<p>其中 Access-Control-Allow-Methods 和 Access-Control-Allow-Headers 不限于浏览器在&quot;预检&quot;中请求的字段，表明服务器支持的所有跨域请求的方法、方法。</p>
<p>如果服务器会不允许，则返回一个正常的 HTTP 回应。浏览器就知道错了，抛出一个错误。</p>
<p>一旦服务器通过了&quot;预检&quot;请求，以后每次浏览器正常的 CORS 请求，就都跟简单请求一样。</p>
<h3 id="windowname"><a class="markdownIt-Anchor" href="#windowname"></a> <a href="http://window.name" target="_blank" rel="noopener">window.name</a></h3>
<p>对当前窗口的 <a href="http://window.name" target="_blank" rel="noopener">window.name</a> 赋值，没有特殊的字符限制。由于 window 对象是浏览器的窗体，而非 document 对象，因此很多时候window 对象不受同源策略的影响。可以利用它，实现跨域、跨页面传递数据。</p>
<p>例如：<br />
<a href="http://www.aaa.com/index.html" target="_blank" rel="noopener">www.aaa.com/index.html</a> 的代码为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.name = <span class="string">"I have a apple."</span>;</span></span><br><span class="line"><span class="javascript">alert(<span class="built_in">document</span>.domain + <span class="string">", "</span> + <span class="built_in">window</span>.name);</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.location = <span class="string">"http://www.bbb.com"</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.bbb.com/index.html" target="_blank" rel="noopener">www.bbb.com/index.html</a> 的代码为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">alert(<span class="built_in">document</span>.domain + <span class="string">", "</span> + <span class="built_in">window</span>.name);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2020/06/11/mudCwkfYetpPlbZ.png" alt="3" /></p>
<p>可以看到数据已经通过 <a href="http://window.name" target="_blank" rel="noopener">window.name</a> 跨域了。</p>
<h3 id="documentdomain"><a class="markdownIt-Anchor" href="#documentdomain"></a> document.domain</h3>
<p>相同主域名不同子域名下的页面，可以设置 document.domain 让它们同域。</p>
<p><a href="http://a.test.com" target="_blank" rel="noopener">a.test.com</a>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span> = <span class="string">"iframe"</span> <span class="attr">src</span>=<span class="string">"http://b.test.com"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.domain = <span class="string">'test.com'</span>;</span></span><br><span class="line"><span class="javascript">        alert(<span class="built_in">document</span>.cookie);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://b.test.com" target="_blank" rel="noopener">b.test.com</a>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'test.com'</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.cookie = <span class="string">"secret=apple"</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="locationhash"><a class="markdownIt-Anchor" href="#locationhash"></a> location.hash</h3>
<p>location.hash 属性是一个可读可写的字符串，该字符串是 URL 的锚部分（从 # 号开始的部分）。</p>
<p>利用 location.hash 来进行传值，父窗口可以把信息写入子窗口，子窗口也可以写入父窗口。</p>
<p>例如，<a href="http://www.aaa.com" target="_blank" rel="noopener">www.aaa.com</a> 下的 a.php 想和 <a href="http://www.bbb.com" target="_blank" rel="noopener">www.bbb.com</a> 下的 b.php 通信，但是由于同源策略的限制他们无法进行交流（b.php无法返回数据），于是就需要一个中间人：<a href="http://www.aaa.com" target="_blank" rel="noopener">www.aaa.com</a> 下的 proxy.php。b.php 将数据传给 proxy.php，由于 proxy.php 和 a.php 同源，于是可通过 proxy.php 将返回的数据传回给 a.php，从而达到跨域的效果。</p>
<p><a href="http://www.aaa.com" target="_blank" rel="noopener">www.aaa.com</a> 下的 a.php：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> ifr = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);  </span></span><br><span class="line"><span class="actionscript">    ifr.src = <span class="string">'http://www.bbb.com/b.php'</span>+location.hash;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(ifr);</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onhashchange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> data = location.hash ? location.hash.substring(<span class="number">1</span>) : <span class="string">''</span>;   </span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">'Now the hash is '</span> + data);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.bbb.com" target="_blank" rel="noopener">www.bbb.com</a> 下的 b.php：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">checkHash</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> data = <span class="built_in">Number</span>(location.hash.substring(<span class="number">1</span>))**<span class="number">2</span> + <span class="number">1</span>;</span></span><br><span class="line">    callBack(data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">callBack</span><span class="params">(hash)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> proxy = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</span></span><br><span class="line"><span class="actionscript">    proxy.src = <span class="string">'http://www.aaa.com/proxy.php#'</span> + hash;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.body.appendChild(proxy);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onload = checkHash;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.aaa.com" target="_blank" rel="noopener">www.aaa.com</a> 下的 proxy.php</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">    parent.parent.location.hash = location.hash;</span><br><span class="line">&#125;</span><br><span class="line"><span class="actionscript">setTimeout(<span class="keyword">set</span>, <span class="number">1000</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>打开 <a href="http://www.aaa.com#100" target="_blank" rel="noopener">http://www.aaa.com#100</a> ，就会返回 100**2+1 = 10001。</p>
<p><img src="https://i.loli.net/2020/06/11/6Tq8ryiHZfBW2XU.png" alt="4" /></p>
<h3 id="windowpostmessage"><a class="markdownIt-Anchor" href="#windowpostmessage"></a> window.postMessage</h3>
<p>HTML5 新增的 postMessage 方法，通过 postMessage 来传递信息，对方可以通过监听 message 事件来监听信息。可跨主域名及双向跨域。</p>
<p>postMessage 的使用方法： otherWindow.postMessage(message,  targetOrigin)</p>
<ul>
<li>otherWindow：目标窗口，给哪个 window 发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口</li>
<li>message：是要发送的消息，类型为 String、Object (IE8、9 不支持)</li>
<li>targetOrigin：是限定消息接收范围，不限制使用 <code>*</code></li>
</ul>
<p>例如：<br />
<a href="http://www.aaa.com" target="_blank" rel="noopener">www.aaa.com</a>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"bbb"</span> <span class="attr">src</span>=<span class="string">"http://www.bbb.com"</span> <span class="attr">onload</span>=<span class="string">"postMsg()"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">postMsg</span> <span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">'bbb'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> bbb = iframe.contentWindow;</span></span><br><span class="line"><span class="actionscript">        bbb.postMessage(<span class="string">"Hello!"</span>, <span class="string">'http://www.bbb.com'</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.bbb.com" target="_blank" rel="noopener">www.bbb.com</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    window.onmessage &#x3D; function(e) &#123;</span><br><span class="line">        if (e.origin !&#x3D;&#x3D; &#39;http:&#x2F;&#x2F;www.aaa.com&#39;) return;</span><br><span class="line">        alert(e.data + &quot; from &quot; + e.origin);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>成功接收到消息：</p>
<p><img src="https://i.loli.net/2020/06/11/rzsjgCn2D7JMHvW.png" alt="5" /></p>
<h2 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h2>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html</a></li>
<li><a href="https://xz.aliyun.com/t/224" target="_blank" rel="noopener">https://xz.aliyun.com/t/224</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">NonupleBroken</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://nonuplebroken.com/2019/07/13/%E6%B5%85%E8%B0%88SOP%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/">https://nonuplebroken.com/2019/07/13/%E6%B5%85%E8%B0%88SOP%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WEB/">WEB</a><a class="post-meta__tags" href="/tags/XSS/">XSS</a><a class="post-meta__tags" href="/tags/SOP/">SOP</a><a class="post-meta__tags" href="/tags/CORS/">CORS</a><a class="post-meta__tags" href="/tags/JSONP/">JSONP</a></div><div class="post_share"><div class="social-share" data-image="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=2021津门杯justOCB" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://i.loli.net/2020/06/15/IhSBM3Q576veJYy.png" alt="WeChat Pay"/><div class="post-qr-code__desc">WeChat Pay</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://i.loli.net/2020/06/15/SI8vipmr2UCxbtR.png" alt="Alipay"/><div class="post-qr-code__desc">Alipay</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/07/20/%E6%B5%85%E8%B0%88CSP%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/"><img class="prev_cover" src="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=浅谈CSP内容安全策略" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">浅谈CSP内容安全策略</div></div></a></div><div class="next-post pull_right"><a href="/2019/07/06/XSS%E5%B0%8F%E7%BB%93/"><img class="next_cover" src="https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images&amp;r=XSS小结" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">XSS小结</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'W5gBlULjrFdLa2PMBAsaecvL-gzGzoHsz',
  appKey: 'e7tEGcjJPX1J35kwFEqnWK0X',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'identicon',
  meta: guestInfo,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://api.btstu.cn/sjbz/api.php?lx=fengjing&amp;format=images)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By NonupleBroken</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Welcome and have fun!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script></body></html>